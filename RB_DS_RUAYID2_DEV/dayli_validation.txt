SELECT SENDOK, CRM FROM (
  SELECT date, medium, source, url.path, sendOkOrder.id
  FROM `raiffeisen-owox.RB_DS_ANALYTICAL_LAYER.ga_sendok_*` 
  WHERE  _TABLE_SUFFIX BETWEEN FORMAT_DATE('%Y%m%d',DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)) AND FORMAT_DATE('%Y%m%d',DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY))
) SENDOK
FULL JOIN (
  SELECT LeadDate, PRODUCT_LINE, leadid, UTM_MEDIUM, UTM_SOURCE
  FROM `raiffeisen-owox.CRM.orders_by_year_2021`
  WHERE DATE(LeadDate) BETWEEN DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY) AND DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY)
) CRM ON REGEXP_EXTRACT( SENDOK.id , r"[0-9]+[a-zA-Z0-9]+[0-9]+") = REGEXP_EXTRACT( CRM.LeadID , r"[0-9]+[a-zA-Z0-9]+[0-9]+")
WHERE (CRM.leadid IS NULL OR SENDOK.id IS NULL) 
AND (CRM.leadid NOT LIKE "%OAP%" OR SENDOK.id NOT LIKE "%OAP%")

